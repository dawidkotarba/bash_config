### EXPORTS ###
export TERM='xterm-256color'

### DIRS ###
BASH_CONFIG_PATH=~/bash_config
source $BASH_CONFIG_PATH/dirs

### aliases ###
alias idea='sh /usr/local/bin/idea/bin/idea.sh &'
alias ll='ls -alh'
alias h='history'
alias j='jobs -l'
alias du='du -h'
alias top='htop'
alias ranger='ranger --choosedir=$HOME/.rangerdir; LASTDIR=`cat $HOME/.rangerdir`; cd "$LASTDIR"'
alias r='ranger'

### Functions ###
__git_add_commit_folder(){
 local FOLDER_NAME=$1
 git -C $FOLDER_NAME commit -a -m "update"
}

__source_if_exists(){
 local FILE=$1
 if [ -f $FILE  ]
  then
   source $FILE
   __echo_ok "Sourced $FILE"
  else
   __echo_err "Cannot source $FILE" 
 fi
}

# echo
__echo_err(){
 local color=`tput setaf 1`
 local reset=`tput sgr0`
 echo "${color}$@${reset}"
}

__echo_ok(){
 local color=`tput setaf 2`
 local reset=`tput sgr0`
 echo "${color}$@${reset}"
}

kk-bash-create-module(){
 local MODULE_NAME=$1
 local MODULE_PATH=$BASH_MODULES_PATH/$MODULE_NAME
 
 if [[ ! -d $MODULE_NAME ]]
  then mkdir $BASH_MODULES_PATH/$MODULE_NAME
 fi
 echo "#!/bin/bash" > $MODULE_PATH/aliases
}

kk-bash-edit(){
 local MODULE_NAME=$1

 if [[ $MODULE_NAME ]]
  then atom $BASH_MODULES_PATH/$MODULE_NAME/aliases
  else atom $BASH_ALIASES_PATH
 fi
}

kk-bash-show(){
 less $BASH_ALIASES_PATH
}

kk-bash-commit(){
 __git_add_commit_folder $BASH_CONFIG_PATH
}

kk-bash-push(){
 git -C $BASH_CONFIG_PATH push
}

kk-bash-commit-push(){
  kk-bash-commit
  kk-bash-push
}

kk-bash-revert(){
  git -C $BASH_CONFIG_PATH checkout -f
}

kk-bak(){
 local date=`date | awk '{print $3"-"$2"-"$4}'`
 cp -r $1 @$1_$date
}
alias bak='kk-bak'

kk-killall(){
  local PROCESS_NAME=$1
  ps aux | grep $PROCESS_NAME | awk '{print $2}' | xargs kill
}
alias killall='kk-killall'

kk-notes-commit(){
  __git_add_commit_folder $NOTES_PATH
}

k(){
  __echo_ok "refreshing..."
  exec bash
}

# DOCKER
kk-docker-start(){
  local CONTAINER_NAME=$1
  echo "Starting docker container: $1"
  sudo docker start $CONTAINER_NAME
  kk-docker-ip $CONTAINER_NAME
}
alias docker-start='kk-docker-start'

kk-docker-ip(){
  local CONTAINER_NAME=$1
  sudo docker inspect $CONTAINER_NAME | grep '"IPAddress"' | tail -n1
}
alias docker-ip='kk-docker-ip'

# GIT
kk-git-parent(){
 current_branch=`git rev-parse --abbrev-ref HEAD`
 git show-branch -a | ag '\*' | ag -v "$current_branch" | head -n1 | sed 's/.*\[\(.*\)\].*/\1/' | sed 's/[\^~].*//'
}
alias git-parent='kk-git-parent'

kk-git-makediff(){
 local DIFF_FILE_PATH=~/diff
 for commit in "$@"
  do
   git show $commit >> $DIFF_FILE_PATH
  done
}

kk-git-difftask(){
  local COMMITS=$(git llog | grep Kotarba | grep $1 | awk '{print $1}')
  local CMD="kk-git-makediff $COMMITS"
  echo kk-git-makediff $COMMITS
}

### NAVIGATE ###
kk-navigate-repo(){
  cd $REPOSITORY_PATH
}

### APPS ###
restclient(){
 (cd /usr/bin && java -jar restclient.jar &)
}

### OPENCONNECT VPN ###
__openconnect_vpn(){
 local USER=$1
 local VPN_URL=$2
 local PARAMS=$3
 sudo openconnect -u $USER $VPN_URL $PARAMS
}

__openconnect_vpn_kill_signal(){
  local SIGNAL=$1
  local PATTERN=$2
  local PS=`ps aux | grep "sudo openconnect" | grep $PATTERN | awk '{print $2}' | head -1`
  if [[ $PS ]]
   then
    __echo_ok "$SIGNAL for VPN: $PATTERN"
    sudo kill -$SIGNAL $PS
   else __echo_err "Not connected to VPN: $PATTERN"
  fi
}

### PATH ###
source $BASH_CONFIG_PATH/path

### MODULES ###
__source_module(){
 local MODULE_FOLDER=$1
 __source_if_exists $BASH_MODULES_PATH/$MODULE_FOLDER/aliases
}

__source_module rpi
__source_module hyb

# OPTIONAL
__source_module epm 
__source_module amw 

### AUTOSTART ###
source $BASH_SCRIPTS_PATH/autostart.sh

### PROGRAMS ###
#z https://github.com/rupa/z.git
source $BASH_APPS_PATH/z/z.sh

# liquidprompt https://github.com/nojhan/liquidprompt.git
[[ $- = *i* ]] && source $BASH_APPS_PATH/liquidprompt/liquidprompt
